<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="eric meyers.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <h2>Attendify</h2>
        <a class="button" href="/logout">Sign Out</a>
    </header>
    <main>
        <div class="hero">
            <h1><span id="admin_full_name"></span></h1>
            <div class="flex">
                <div class="svg_verified"></div>
                <p>Verified Admin</p>
            </div>
        </div>

        <section>
            <h2>Database Manager</h2>
            <div class="tab-container" role="tablist">
                <button class="tab-button active" data-tab="users" role="tab">Users</button>
                <button class="tab-button" data-tab="students" role="tab">Students</button>
                <button class="tab-button" data-tab="student_classes" role="tab">Student Classes</button>
                <button class="tab-button" data-tab="courses" role="tab">Courses</button>
                <button class="tab-button" data-tab="classes" role="tab">Classes</button>
            </div>
            <div class="tab-content active" data-tab="users" role="tabpanel">
                <h3>Users</h3>
                <div class="displayTable">
                    <table>
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Username</th>
                                <th>Full Name</th>
                                <th>Role</th>
                            </tr>
                        </thead>
                        <tbody id="admin_tableuser">

                        </tbody>
                    </table>
                </div>
            </div>
            <div class="tab-content" data-tab="students" role="tabpanel">
                <h3>Students</h3>
                <div class="displayTable">
                    <table>
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Student ID</th>
                                <th>Full Name</th>
                                <th>RFID</th>
                                <th>Is Regular?</th>
                                <th>Grade Section</th>
                                <th>Profile Image</th>
                                <th>Guardian Contact</th>
                            </tr>
                        </thead>
                        <tbody id="admin_tablestudents">

                        </tbody>
                    </table>
                </div>
            </div>
            <div class="tab-content" data-tab="student_classes" role="tabpanel">
                <h3>Student Classes</h3>
                <div class="displayTable">
                    <table>
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Student ID</th>
                                <th>Class ID</th>
                                <th>Enrollment Type</th>
                                <th>Enrollment Date</th>
                            </tr>
                        </thead>
                        <tbody id="admin_tablestudent_classes">

                        </tbody>
                    </table>
                </div>
            </div>
            <div class="tab-content" data-tab="courses" role="tabpanel">
                <h3>Courses</h3>
                <div class="displayTable">
                    <table>
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Course Code</th>
                                <th>Course Name</th>
                            </tr>
                        </thead>
                        <tbody id="admin_tablecourses">

                        </tbody>
                    </table>
                </div>
            </div>
            <div class="tab-content" data-tab="classes" role="tabpanel">
                <h3>Classes</h3>
                <div class="displayTable">
                    <table>
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Class ID</th>
                                <th>Course Code</th>
                                <th>Grade Section</th>
                                <th>Instructor Username</th>
                                <th>Day</th>
                                <th>Start Time</th>
                                <th>End Time</th>
                            </tr>
                        </thead>
                        <tbody id="admin_tableclasses">

                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <section>
            <h2>Registration</h2>
            <div class="tab-container" role="tablist">
                <button class="tab-button active" data-tab="guards" role="tab">Guards</button>
                <button class="tab-button" data-tab="teachers" role="tab">Teachers</button>
                <button class="tab-button" data-tab="admins" role="tab">Admins</button>
                <button class="tab-button" data-tab="students" role="tab">Students</button>
            </div>
            <div class="tab-content active" data-tab="guards" role="tabpanel">
                <h3>Role of Guards</h3>
                <p>Guards scan each registered students RFIDs with a physical device supported by Attendify. Once scanned, the basic information will show on their screen to ensure validity & avoid proxy attendance.</p>
                <form action="/admins/createGuard" method="post">
                    <small>Complete Name</small><br>
                    <input type="text" name="fullname" placeholder="Johnny Appleseed" required><br>
                    <button type="submit">Create Guard Account</button>
                </form>
            </div>
            <div class="tab-content" data-tab="teachers" role="tabpanel">
                <h3>Teachers</h3>
                <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Officiis voluptatibus dicta qui quod unde. Unde asperiores delectus aliquam. Illum quos nulla at id, iste voluptatibus doloremque cum repellat culpa tenetur.</p>
                <form action="/admins/createTeacher" method="post">
                    <small>Complete Name</small><br>
                    <input type="text" name="fullname" placeholder="Johnny Appleseed" required><br>
                    <button type="submit">Create Teacher Account</button>
                </form>
            </div>
            <div class="tab-content" data-tab="admins" role="tabpanel">
                <h3>Admins</h3>
                <p>Admins have full access to the system, the records, automation and database</p>
                <form action="/admins/createAdmin" method="post">
                    <small>Complete Name</small><br>
                    <input type="text" name="fullname" placeholder="Johnny Appleseed" required><br>
                    <button type="submit">Create Admin Account</button>
                </form>
            </div>
            <div class="tab-content" data-tab="students" role="tabpanel">
                <h3>Students</h3>
                <h1>students are HARD to configure</h1>
                <form id="studentForm" action="/admins/createStudent" method="POST">
                    <h3>Registering Student</h3>
                
                    <label>Student ID (Provided by School)</label>
                    <input type="text" name="student_id" placeholder="e.g. 02000376725" required>
                
                    <label>Complete Name</label>
                    <input type="text" name="full_name" placeholder="e.g. Johnny Appleseed" required>
                
                    <label>RFID Number (Unique)</label>
                    <input type="text" name="rfid" placeholder="e.g. RFID0001" required>
                
                    <label>Is the student Regular or Irregular?</label>
                    <select name="is_regular" id="is_regular" required onchange="toggleGradeSection()">
                        <option value="1">Regular Student</option>
                        <option value="0">Irregular Student</option>
                    </select>
                
                    <div id="regularSection">
                        <label>Grade Section (Only for Regular Students)</label>
                        <input type="text" name="grade_section" id="grade_section" placeholder="e.g. 12-MAWD" required>
                    </div>
                
                    <div id="irregularSection" style="display: none;">
                        <label>Select Subjects (For Irregular Students)</label>
                        <div id="subjectList">Loading subjects...</div>
                    </div>
                
                    <label>Parent/Guardian Contact Number</label>
                    <input type="text" name="guardian_contact" placeholder="e.g. +639261234567" required>
                
                    <label>(Advanced) Student Profile Image</label>
                    <input type="file" name="profile_image" accept="image/*">
                
                    <button type="submit">+ Enroll Student to Attendify</button>
                </form>
                
                <script>
                    function toggleGradeSection() {
                        const isRegular = document.getElementById('is_regular').value == "1";
                        const gradeSectionInput = document.getElementById('grade_section');
                        const irregularSection = document.getElementById('irregularSection');

                        if (isRegular) {
                            gradeSectionInput.removeAttribute('disabled');
                            gradeSectionInput.setAttribute('required', 'true');
                            irregularSection.style.display = "none";
                        } else {
                            gradeSectionInput.setAttribute('disabled', 'true');
                            gradeSectionInput.removeAttribute('required');
                            irregularSection.style.display = "block";
                            fetchSubjects(); // Load subjects when Irregular is selected
                        }
                    }



                    async function fetchSubjects() {
                        try {
                            const response = await fetch("/admins/api"); // Fetch all admin data
                            const data = await response.json();

                            if (data.admin_classes) {
                                const subjectListDiv = document.getElementById("subjectList");
                                subjectListDiv.innerHTML = ""; // Clear loading text
                                
                                data.admin_classes.forEach((subject) => {
                                    const checkbox = document.createElement("input");
                                    checkbox.type = "checkbox";
                                    checkbox.name = "class_ids";
                                    checkbox.value = subject.class_id;

                                    const label = document.createElement("label");
                                    label.textContent = `${subject.class_id} - ${subject.teacher_username}`;
                                    
                                    const div = document.createElement("div");
                                    div.appendChild(checkbox);
                                    div.appendChild(label);

                                    subjectListDiv.appendChild(div);
                                });
                            }
                        } catch (error) {
                            console.error("Error fetching subjects:", error);
                        }
                    }
                </script>
            </div>
        </section>

        <section>
            <h2>Courses*</h2>
            <form action="/admins/addCourse" method="post">
                <small>Course Code (Provided by School)</small><br>
                <input type="text" name="coursecode" placeholder="e.g. SHS1000" required><br>
                <small>Course Description</small><br>
                <input type="text" name="coursename" placeholder="e.g. Artificial Intelligence IV" required><br>
                <button type="submit">+ Add Course</button>
            </form>
        </section>

        <section>
            <h2>Classes</h2>
            <p>The same teacher may have multiple classes as long as the schedules don't interfere</p>
            <form action="/admins/addClass" method="post">
                <h3>General</h3>
                <small>What Subject? In Course Code (Provided by School)</small><br>
                <input type="text" name="coursecode" placeholder="e.g. SHS1000" required><br>
                <small>For Grade Section?</small><br>
                <input type="text" name="gradesection" placeholder="e.g. 12-STEM" required><br>
                <small>Whos the Instructor for this course?</small><br>
                <input type="text" name="username" placeholder="e.g. johnny.appleseed" required><br>
                <h3>Schedule</h3>
                <small>Day of class</small><br>
                <select name="day" title="day">
                    <option value="Mon" default>Mon</option>
                    <option value="Tue">Tue</option>
                    <option value="Wed">Wed</option>
                    <option value="Thu">Thu</option>
                    <option value="Fri">Fri</option>
                </select><br>
                <small>Start Time</small><br>
                <input type="text" name="starttime" placeholder="e.g. 10:30" required><br>
                <small>End Time</small><br>
                <input type="text" name="endtime" placeholder="e.g. 10:30" required><br>
                <button type="submit">+ Add Class</button>
            </form>
        </section>
    </main>
</body>
<script>
document.addEventListener("DOMContentLoaded", () => {
    document.querySelectorAll(".displayTable").forEach(element => {
        element.addEventListener("click", () => {
            element.classList.toggle("immersive");
        });
    });
});

document.addEventListener('DOMContentLoaded', () => {
  document.querySelectorAll('.tab-container').forEach(container => {
    container.addEventListener('click', event => {
      if (event.target.matches('.tab-button')) {
        const selectedTab = event.target.getAttribute('data-tab');
        const section = event.target.closest('section');

        // Remove active classes from all buttons and contents in this section
        section.querySelectorAll('.tab-button').forEach(button => {
          button.classList.remove('active');
          button.setAttribute('aria-selected', 'false');
        });
        section.querySelectorAll('.tab-content').forEach(content => {
          content.classList.remove('active');
        });

        // Activate the clicked tab and corresponding content
        event.target.classList.add('active');
        event.target.setAttribute('aria-selected', 'true');
        section.querySelector(`.tab-content[data-tab="${selectedTab}"]`).classList.add('active');
      }
    });
  });
});

async function admins_me() {
    const response = await fetch('/admins/me')
    const data = await response.json()

    document.getElementById('admin_full_name').textContent = data.fullname[0].full_name
}

admins_me()

async function admins_api() {
    const response = await fetch('/admins/api')
    const data  = await response.json()

    data.admin_users.forEach((eachData, index) => {
        document.getElementById('admin_tableuser').innerHTML += `
        <tr>
            <td>${index + 1}</td>
            <td>${eachData.username}</td>
            <td>${eachData.full_name}</td>
            <td>${eachData.role}</td>
        </tr>
        `;
    });

    data.admin_students.forEach((eachData, index) => {
        document.getElementById('admin_tablestudents').innerHTML += `
        <tr>
            <td>${index + 1}</td>
            <td>${eachData.student_id}</td>
            <td>${eachData.full_name}</td>
            <td>${eachData.rfid}</td>
            <td>${eachData.is_regular}</td>
            <td>${eachData.grade_section}</td>
            <td>${eachData.profile_image}</td>
            <td>${eachData.guardian_contact}</td>
        </tr>
        `;
    });

    data.admin_student_classes.forEach((eachData, index) => {
        document.getElementById('admin_tablestudent_classes').innerHTML += `
        <tr>
            <td>${index + 1}</td>
            <td>${eachData.student_id}</td>
            <td>${eachData.class_id}</td>
            <td>${eachData.enrollment_type}</td>
            <td>${eachData.enrollment_date}</td>
        </tr>
        `;
    });

    data.admin_courses.forEach((eachData, index) => {
        document.getElementById('admin_tablecourses').innerHTML += `
        <tr>
            <td>${index + 1}</td>
            <td>${eachData.course_code}</td>
            <td>${eachData.course_name}</td>
        </tr>
        `;
    });

    data.admin_classes.forEach((eachData, index) => {
        document.getElementById('admin_tableclasses').innerHTML += `
        <tr>
            <td>${index + 1}</td>
            <td>${eachData.class_id}</td>
            <td>${eachData.course_code}</td>
            <td>${eachData.grade_section}</td>
            <td>${eachData.teacher_username}</td>
            <td>${eachData.day}</td>
            <td>${eachData.start_time}</td>
            <td>${eachData.end_time}</td>
        </tr>
        `;
    });
}

admins_api()
</script>
<script>
    function autoResizeInput(input) {
      input.style.width = "1px"; // Reset width to get accurate measurement
      input.style.width = (input.value.length + 1) + "ch";
    }
  
    document.querySelectorAll('input[type="text"]').forEach(input => {
      input.addEventListener("input", () => autoResizeInput(input));
      autoResizeInput(input); // Initialize width on page load
    });
  </script>
</html>